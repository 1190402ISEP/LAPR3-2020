<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1614px" preserveAspectRatio="none" style="width:1679px;height:1614px;" version="1.1" viewBox="0 0 1679 1614" width="1679px" zoomAndPan="magnify"><defs><filter height="300%" id="fwjt5b3dfn536" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="1411.0078" style="stroke:#A80036;stroke-width:1.0;" width="10" x="36" y="99.6094"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="258.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="121.9609"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="137.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="435.7734"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="90.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="603.5313"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="114.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="756.9375"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="60.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="1031.75"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="181.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="1329.2109"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="181.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="152.3125"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="60.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="466.125"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="60.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="633.8828"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="84.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="787.2891"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="1062.1016"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="120.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="1359.5625"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="762" y="182.6641"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="897" y="243.0156"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1021" y="303.3672"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="496.4766"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="915.6953"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1154.8047"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1222.1563"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1389.9141"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1450.2656"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1337.5" y="664.2344"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="307.1641" style="stroke:#000000;stroke-width:2.0;" width="1366.5" x="10" y="395.0703"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="170.1094" style="stroke:#000000;stroke-width:2.0;" width="757" x="10" y="716.2344"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="139.4063" style="stroke:#000000;stroke-width:2.0;" width="629.5" x="10" y="960.6953"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="78.7031" style="stroke:#000000;stroke-width:2.0;" width="730" x="432.5" y="1114.1016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="41" x2="41" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="346.5" x2="346.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="535.5" x2="535.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="766.5" x2="766.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="901.5" x2="901.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1025.5" x2="1025.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1113.5" x2="1113.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1235.5" x2="1235.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1342.5" x2="1342.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1435.5" x2="1435.5" y1="89.6094" y2="1528.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1587.5" x2="1587.5" y1="89.6094" y2="1528.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="20" y="86.5332">Client</text><ellipse cx="41" cy="15" fill="#FEFECE" filter="url(#fwjt5b3dfn536)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M41,23 L41,50 M28,31 L54,31 M41,50 L28,65 M41,50 L54,65 " fill="none" filter="url(#fwjt5b3dfn536)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="20" y="1542.1504">Client</text><ellipse cx="41" cy="1555.2266" fill="#FEFECE" filter="url(#fwjt5b3dfn536)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M41,1563.2266 L41,1590.2266 M28,1571.2266 L54,1571.2266 M41,1590.2266 L28,1605.2266 M41,1590.2266 L54,1605.2266 " fill="none" filter="url(#fwjt5b3dfn536)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="133" x="278.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="285.5" y="74.5332">:CheckoutBasketUI</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="133" x="278.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="285.5" y="1549.1504">:CheckoutBasketUI</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="183" x="442.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="449.5" y="74.5332">:CheckoutBasketController</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="183" x="442.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="449.5" y="1549.1504">:CheckoutBasketController</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="97" x="716.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="723.5" y="74.5332">:UserSession</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="97" x="716.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="723.5" y="1549.1504">:UserSession</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="145" x="827.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="834.5" y="74.5332">session:UserSession</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="145" x="827.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="834.5" y="1549.1504">session:UserSession</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="75" x="986.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="993.5" y="74.5332">user:User</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="75" x="986.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="993.5" y="1549.1504">user:User</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="73" x="1075.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1082.5" y="74.5332">:ClientDB</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="73" x="1075.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1082.5" y="1549.1504">:ClientDB</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="142" x="1162.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="1169.5" y="74.5332">list:List&lt;CreditCard&gt;</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="142" x="1162.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="1169.5" y="1549.1504">list:List&lt;CreditCard&gt;</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="44" x="1318.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="1325.5" y="74.5332">:Utils</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="44" x="1318.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="1325.5" y="1549.1504">:Utils</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="115" x="1376.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="1383.5" y="74.5332">card:CreditCard</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="115" x="1376.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="1383.5" y="1549.1504">card:CreditCard</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="160" x="1505.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="1512.5" y="74.5332">products:List&lt;Product&gt;</text><rect fill="#FEFECE" filter="url(#fwjt5b3dfn536)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="160" x="1505.5" y="1527.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="1512.5" y="1549.1504">products:List&lt;Product&gt;</text><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="1411.0078" style="stroke:#A80036;stroke-width:1.0;" width="10" x="36" y="99.6094"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="258.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="121.9609"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="137.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="435.7734"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="90.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="603.5313"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="114.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="756.9375"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="60.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="1031.75"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="181.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="1329.2109"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="181.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="152.3125"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="60.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="466.125"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="60.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="633.8828"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="84.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="787.2891"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="1062.1016"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="120.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="531" y="1359.5625"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="762" y="182.6641"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="897" y="243.0156"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1021" y="303.3672"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="496.4766"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="915.6953"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1154.8047"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1222.1563"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1389.9141"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1109" y="1450.2656"/><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1337.5" y="664.2344"/><polygon fill="#A80036" points="330,117.9609,340,121.9609,330,125.9609,334,121.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46" x2="336" y1="121.9609" y2="121.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="53" y="117.1045">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="64" y="117.1045">The client starts the checkout</text><polygon fill="#A80036" points="519,148.3125,529,152.3125,519,156.3125,523,152.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="525" y1="152.3125" y2="152.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="359" y="147.4561">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="370" y="147.4561">getClient()</text><polygon fill="#A80036" points="750,178.6641,760,182.6641,750,186.6641,754,182.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="756" y1="182.6641" y2="182.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="548" y="177.8076">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="559" y="177.8076">session = getUserSession()</text><polygon fill="#A80036" points="885,239.0156,895,243.0156,885,247.0156,889,243.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="891" y1="243.0156" y2="243.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="548" y="238.1592">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="559" y="238.1592">user = getUser()</text><polygon fill="#A80036" points="1009,299.3672,1019,303.3672,1009,307.3672,1013,303.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="1015" y1="303.3672" y2="303.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="548" y="298.5107">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="559" y="298.5107">email = getUserEmail()</text><polygon fill="#A80036" points="57,376.0703,47,380.0703,57,384.0703,53,380.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51" x2="346" y1="380.0703" y2="380.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="63" y="367.0381">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="74" y="358.8623">asks user if he want to use an</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="74" y="375.2139">existing credit card or to create another</text><path d="M10,395.0703 L71,395.0703 L71,403.0703 L61,413.0703 L10,413.0703 L10,395.0703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="307.1641" style="stroke:#000000;stroke-width:2.0;" width="1366.5" x="10" y="395.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="409.5654">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="197" x="86" y="408.4893">[if he wants to use an existing card]</text><polygon fill="#A80036" points="330,431.7734,340,435.7734,330,439.7734,334,435.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46" x2="336" y1="435.7734" y2="435.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="53" y="430.917">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="64" y="430.917">requests the list of cards he have</text><polygon fill="#A80036" points="519,462.125,529,466.125,519,470.125,523,466.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="525" y1="466.125" y2="466.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="359" y="461.2686">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="370" y="461.2686">getCreditCardsClient()</text><polygon fill="#A80036" points="1097,492.4766,1107,496.4766,1097,500.4766,1101,496.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="1103" y1="496.4766" y2="496.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="548" y="491.6201">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="559" y="491.6201">list = getClientCreditCardsByEmail(email)</text><polygon fill="#A80036" points="57,569.1797,47,573.1797,57,577.1797,53,573.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51" x2="346" y1="573.1797" y2="573.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="63" y="560.1475">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="81" y="551.9717">shows the list of credit cards</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="85" y="568.3232">and asks user to choose one</text><polygon fill="#A80036" points="330,599.5313,340,603.5313,330,607.5313,334,603.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46" x2="336" y1="603.5313" y2="603.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="53" y="598.6748">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="71" y="598.6748">selects credit card</text><polygon fill="#A80036" points="519,629.8828,529,633.8828,519,637.8828,523,633.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="525" y1="633.8828" y2="633.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="359" y="629.0264">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="377" y="629.0264">getCardByOption(option)</text><polygon fill="#A80036" points="1325.5,660.2344,1335.5,664.2344,1325.5,668.2344,1329.5,664.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="1331.5" y1="664.2344" y2="664.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="548" y="659.3779">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="566" y="659.3779">card = getItemByOption(list, option)</text><path d="M10,716.2344 L71,716.2344 L71,724.2344 L61,734.2344 L10,734.2344 L10,716.2344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="170.1094" style="stroke:#000000;stroke-width:2.0;" width="757" x="10" y="716.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="730.7295">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="231" x="86" y="729.6533">[if user wants to create a new credit card]</text><polygon fill="#A80036" points="330,752.9375,340,756.9375,330,760.9375,334,756.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46" x2="336" y1="756.9375" y2="756.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="53" y="752.0811">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="71" y="752.0811">the user requests to create a new credit card</text><polygon fill="#A80036" points="519,783.2891,529,787.2891,519,791.2891,523,787.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="525" y1="787.2891" y2="787.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="359" y="782.4326">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="377" y="782.4326">newCreditCard()</text><rect fill="#FFFFFF" filter="url(#fwjt5b3dfn536)" height="42.7031" style="stroke:#000000;stroke-width:2.0;" width="189" x="439.5" y="795.2891"/><polygon fill="#EEEEEE" points="439.5,795.2891,501.5,795.2891,501.5,803.2891,491.5,813.2891,439.5,813.2891,439.5,795.2891" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="452.5" y="810.7842">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="455" y="830.7842">SD_UC22_Add_Credit_Card</text><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="583" y1="870.3438" y2="870.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="583" x2="583" y1="870.3438" y2="883.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536" x2="583" y1="883.3438" y2="883.3438"/><polygon fill="#A80036" points="546,879.3438,536,883.3438,546,887.3438,542,883.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="548" y="865.4873">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="566" y="865.4873">card = getClientLastAddedCard()</text><polygon fill="#A80036" points="1097,911.6953,1107,915.6953,1097,919.6953,1101,915.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536" x2="1103" y1="915.6953" y2="915.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="543" y="910.8389">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="561" y="910.8389">flag = hasClientNif(email)</text><path d="M10,960.6953 L71,960.6953 L71,968.6953 L61,978.6953 L10,978.6953 L10,960.6953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="139.4063" style="stroke:#000000;stroke-width:2.0;" width="629.5" x="10" y="960.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="975.1904">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81" x="86" y="974.1143">[if flag is false]</text><polygon fill="#A80036" points="57,997.3984,47,1001.3984,57,1005.3984,53,1001.3984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51" x2="346" y1="1001.3984" y2="1001.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="63" y="996.542">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="81" y="996.542">requests data (NIF)</text><polygon fill="#A80036" points="330,1027.75,340,1031.75,330,1035.75,334,1031.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46" x2="336" y1="1031.75" y2="1031.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="53" y="1026.8936">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="71" y="1026.8936">enters the nif</text><polygon fill="#A80036" points="519,1058.1016,529,1062.1016,519,1066.1016,523,1062.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="525" y1="1062.1016" y2="1062.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="359" y="1057.2451">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="377" y="1057.2451">setNif(nif)</text><path d="M432.5,1114.1016 L493.5,1114.1016 L493.5,1122.1016 L483.5,1132.1016 L432.5,1132.1016 L432.5,1114.1016 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="78.7031" style="stroke:#000000;stroke-width:2.0;" width="730" x="432.5" y="1114.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="447.5" y="1128.5967">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="77" x="508.5" y="1127.5205">[if flag is true]</text><polygon fill="#A80036" points="1097,1150.8047,1107,1154.8047,1097,1158.8047,1101,1154.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536" x2="1103" y1="1154.8047" y2="1154.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="543" y="1149.9482">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="561" y="1149.9482">nif = getClientNifByEmail(email)</text><polygon fill="#A80036" points="1097,1218.1563,1107,1222.1563,1097,1226.1563,1101,1222.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536" x2="1103" y1="1222.1563" y2="1222.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="543" y="1217.2998">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="561" y="1217.2998">credits = getClientCreditsByEmail(email)</text><polygon fill="#A80036" points="57,1294.8594,47,1298.8594,57,1302.8594,53,1298.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51" x2="346" y1="1298.8594" y2="1298.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="63" y="1285.8271">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="81" y="1277.6514">shows available credits and ask</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="85" y="1294.0029">how many he wants to use</text><polygon fill="#A80036" points="330,1325.2109,340,1329.2109,330,1333.2109,334,1329.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46" x2="336" y1="1329.2109" y2="1329.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="53" y="1324.3545">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="71" y="1324.3545">enters the aumount of credits (creditsToUse)</text><polygon fill="#A80036" points="519,1355.5625,529,1359.5625,519,1363.5625,523,1359.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="525" y1="1359.5625" y2="1359.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="359" y="1354.7061">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="377" y="1354.7061">newOrder()</text><polygon fill="#A80036" points="1097,1385.9141,1107,1389.9141,1097,1393.9141,1101,1389.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="1103" y1="1389.9141" y2="1389.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="548" y="1385.0576">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="308" x="566" y="1385.0576">products = getProductsInBasketByClientEmail(email)</text><polygon fill="#A80036" points="1097,1446.2656,1107,1450.2656,1097,1454.2656,1101,1450.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="1103" y1="1450.2656" y2="1450.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="548" y="1445.4092">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="566" y="1445.4092">newOrder(email, products, card, nif, creditsToUse)</text><polygon fill="#A80036" points="52,1506.6172,42,1510.6172,52,1514.6172,48,1510.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46" x2="346" y1="1510.6172" y2="1510.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="58" y="1505.7607">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="76" y="1505.7607">process finished</text><!--MD5=[0cd26524851d6d3d48f55d3a5e705db2]
@startuml
autonumber

actor "Client" as CLI

participant ":CheckoutBasketUI" as UI
participant ":CheckoutBasketController" as CTRL
participant ":UserSession" as US
participant "session:UserSession" as S
participant "user:User" as U
participant ":ClientDB" as DB
participant "list:List<CreditCard>" as LIST
participant ":Utils" as SCARD
participant "card:CreditCard" as CARD
participant "products:List<Product>" as PRO





activate CLI
CLI -> UI: The client starts the checkout
activate UI

UI-> CTRL: getClient()

activate CTRL

CTRL -> US: session = getUserSession()
activate US
deactivate US

CTRL -> S: user = getUser()

activate S
deactivate S
 CTRL -> U: email = getUserEmail()

 activate U
 deactivate U

 deactivate CTRL


UI - -> CLI: asks user if he want to use an \nexisting credit card or to create another

deactivate UI

alt if he wants to use an existing card

CLI -> UI: requests the list of cards he have

activate UI

UI -> CTRL: getCreditCardsClient()

activate CTRL



 CTRL -> DB: list = getClientCreditCardsByEmail(email)

 activate DB
 deactivate DB

deactivate CTRL

UI - -> CLI: shows the list of credit cards\n and asks user to choose one


deactivate UI

CLI -> UI: selects credit card

activate UI


UI -> CTRL: getCardByOption(option)

activate CTRL

CTRL -> SCARD: card = getItemByOption(list, option)
activate SCARD
deactivate SCARD

deactivate CTRL

deactivate UI

end


alt if user wants to create a new credit card

CLI -> UI: the user requests to create a new credit card

activate UI

UI -> CTRL: newCreditCard()

activate CTRL

ref over CTRL: SD_UC22_Add_Credit_Card

CTRL -> CTRL: card = getClientLastAddedCard()

deactivate CTRL

deactivate UI

end



CTRL -> DB: flag = hasClientNif(email)

activate DB

deactivate DB

alt if flag is false

UI - -> CLI: requests data (NIF)

CLI -> UI: enters the nif

activate UI

UI -> CTRL: setNif(nif)

activate CTRL
deactivate CTRL

deactivate UI


end



alt if flag is true

CTRL -> DB: nif = getClientNifByEmail(email)

activate DB
deactivate DB

end

CTRL -> DB: credits = getClientCreditsByEmail(email)

activate DB
deactivate DB

UI - -> CLI: shows available credits and ask\n how many he wants to use

CLI -> UI: enters the aumount of credits (creditsToUse)

activate UI

UI -> CTRL: newOrder()

activate CTRL


CTRL -> DB: products = getProductsInBasketByClientEmail(email)

activate DB
deactivate DB

CTRL -> DB: newOrder(email, products, card, nif, creditsToUse)

activate DB
deactivate DB

deactivate CTRL

UI - -> CLI: process finished

deactivate UI
deactivate CLI





@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: pt
Country: PT
--></g></svg>